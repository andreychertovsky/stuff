Sub Button_run()

    Dim fDate As Date
    Dim lDate As Date
    Dim dateLoop As Date
    Dim rCount As Long
    Dim I As Long
    Dim defectCount, planCount, stopCount, fixCount, fixAfter, revealFix As Long
      
    Set wb = ActiveWorkbook
    Set wsDefect = wb.Sheets("æóðíàë äåôåêòîâ")
    Set wsReport = wb.Sheets("Îò÷¸ò")
        
    rCount = wsDefect.Range("B" & Rows.Count).End(xlUp).Row 'count row in defect sheet
    
    fDate = Cells(5, "C").Value
    lDate = Cells(5, "D").Value
    
    If fDate = 0 Or lDate = 0 Then
        MsgBox "Range is empty"
        Exit Sub
    End If
    
    'all defect in particular range
    defectCount = 0
    For I = 2 To rCount
        With wsDefect
            .Select
            For dateLoop = fDate To lDate
                If DateDiff("d", Cells(I, "B").Value, dateLoop) = 0 Then
                    defectCount = defectCount + 1
                End If
            Next dateLoop
        End With
    Next I
    
    'plan fix  defect in range
    planCount = 0
    stopCount = 0
    For I = 2 To rCount
        With wsDefect
            .Select
            If Cells(I, "K").Value = "" Then
            ElseIf Cells(I, "K").Value = "âî âðåìÿ îñòàíîâêè" Then
                stopCount = stopCount + 1
            Else
                For dateLoop = fDate To lDate
                    If DateDiff("d", Cells(I, "K").Value, dateLoop) = 0 Then
                        planCount = planCount + 1
                    End If
                Next dateLoop
            End If
        End With
    Next I
    
    'fix defect in range
    fixCount = 0
    For I = 2 To rCount
        With wsDefect
            .Select
            If Cells(I, "N") = "" Then
            Else
                For dateLoop = fDate To lDate
                    If DateDiff("d", Cells(I, "N").Value, dateLoop) = 0 Then
                        fixCount = fixCount + 1
                    End If
                Next dateLoop
            End If
        End With
    Next I
    
    'fix after specific date
    fixAfter = 0
    For I = 2 To rCount
        With wsDefect
            .Select
            If Cells(I, "K").Value = "" Or Cells(I, "K").Value = "âî âðåìÿ îñòàíîâêè" Then
            ElseIf Cells(I, "K").Value > DateValue(lDate) Then
                fixAfter = fixAfter + 1
            End If
        End With
    Next I
    
    'revealed defect fix
    revealFix = 0
    For I = 2 To rCount
        With wsDefect
            .Select
            If Cells(I, "N") = "" Then
            Else
                For dateLoop = fDate To lDate
                    If DateDiff("d", Cells(I, "K").Value, dateLoop) = 0 And Cells(I, "N").Value <= DateValue(lDate) Then
                        revealFix = revealFix + 1
                    End If
                Next dateLoop
            End If
        End With
    Next I
    
ExitTheSub:
    With wsReport
        .Select
        Cells(5, "E").Value = defectCount
        Cells(5, "F").Value = planCount
        Cells(5, "G").Value = fixAfter
        Cells(5, "H").Value = stopCount
        Cells(5, "I").Value = fixCount
        Cells(5, "J").Value = revealFix
        MsgBox "All Done"
    End With
End Sub

